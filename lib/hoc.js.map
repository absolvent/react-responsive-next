{"version":3,"sources":["../src/hoc.js"],"names":["hoc","console","log","process","browser","window","innerWidth","document","documentElement","clientWidth","body","ReactResponsiveNextHoc","updateDeviceTypeByViewportSize","detectedMedia","mediaQueriesMatchers","forEach","mediaItem","matcher","matches","defaultWidth","Cookies","save","secure","type","mediaType","media","customConfig","defaultConfig","desktop","args","newProps","env","req","device","eval","detectedMediaType","load","detectedMediaWidth","checkEnvironment","headers","ua","detectedDevice","userAgentMediaType","getDefaultMediaWidthByType","detectedMediaModel","model","newArgs","WrappedComponent","getInitialProps","MediaQueryWrapper","fakeWidth","props","config","mediaQuery","width","getBrowserWidth","push","state","onResize","onResizeHandler","addEventListener","removeEventListener","React","Component","propTypes","PropTypes","shape","breakPoints","any","devicesToBreakPoints","defaultProps"],"mappings":"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","sourcesContent":["/* global require */\n\nimport debounce from 'lodash.debounce';\nimport matchMediaQuery from 'matchmediaquery';\nimport PropTypes from 'prop-types';\nimport Cookies from 'isomorphic-cookie';\nimport React from 'react';\nimport { MediaQueryWrapper } from './components';\nimport { getMedia } from './media';\nimport { defaultConfig } from './default-config';\n\nexport const hoc = WrappedComponent =>\n  class ReactResponsiveNextHoc extends React.Component {\n\n    static customConfig = null;\n\n    static propTypes = {\n      config: PropTypes.shape({\n        breakPoints: PropTypes.any,\n        devicesToBreakPoints: PropTypes.any,\n      }),\n    };\n\n    static defaultProps = {\n      config: hoc.customConfig || defaultConfig,\n    };\n\n    static getBrowserWidth() {\n      console.log('HOC', 'getBrowserWidth');\n      if (process.browser) {\n        return window.innerWidth ||\n          document.documentElement.clientWidth ||\n          document.body.clientWidth;\n      }\n      return -1;\n    }\n\n    static onResize() {\n      console.log('HOC', 'onResize');\n      ReactResponsiveNextHoc.updateDeviceTypeByViewportSize();\n    }\n\n    static updateDeviceTypeByViewportSize() {\n      console.log('HOC', 'updateDeviceTypeByViewportSize');\n      let detectedMedia = null;\n      ReactResponsiveNextHoc.mediaQueriesMatchers.forEach((mediaItem) => {\n        if (mediaItem.matcher.matches) {\n          if (!detectedMedia\n            || (detectedMedia && detectedMedia.defaultWidth < mediaItem.defaultWidth)) {\n            detectedMedia = mediaItem;\n          }\n        }\n      });\n      Cookies.save('detectedMediaWidth', detectedMedia.defaultWidth, { secure: false });\n      Cookies.save('detectedMediaType', detectedMedia.type, { secure: false });\n    }\n\n    static getDefaultMediaWidthByType(mediaType) {\n      const media = getMedia(hoc.customConfig || defaultConfig);\n      if (media[mediaType]) {\n        return media[mediaType].defaultWidth;\n      }\n      return media.desktop.defaultWidth;\n    }\n\n    static async getInitialProps(args = {}) {\n      let newProps = {\n        env: {},\n      };\n\n      if (args && args.req) {\n        const device = eval('require(\\'device\\')'); // it's not bundled to a browser js\n        const detectedMediaType = Cookies.load('detectedMediaType', args.req);\n        const detectedMediaWidth = Cookies.load('detectedMediaWidth', args.req);\n        const checkEnvironment = ({ headers = {} } = {}) => {\n          const ua = headers['user-agent'] || headers['User-Agent'] || '';\n          const detectedDevice = device(ua);\n          return {\n            userAgentMediaType: detectedDevice.type,\n            detectedMediaType: detectedMediaType || detectedDevice.type,\n            detectedMediaWidth: detectedMediaWidth\n              || ReactResponsiveNextHoc.getDefaultMediaWidthByType(detectedDevice.type),\n            detectedMediaModel: detectedDevice.model || null,\n          }\n        };\n        newProps.env = checkEnvironment(args.req);\n      } else {\n        newProps.env = {\n          userAgentMediaType: null,\n          detectedMediaType: null,\n          detectedMediaWidth: 0,\n          detectedMediaModel: null,\n        };\n      }\n      const newArgs = {\n        ...args,\n        ...newProps,\n      };\n      if (WrappedComponent.getInitialProps) {\n        newProps = {\n          ...newProps,\n          ...await WrappedComponent.getInitialProps(newArgs),\n        };\n      }\n      MediaQueryWrapper.fakeWidth = newProps.env.detectedMediaWidth;\n      return newProps;\n    }\n\n    constructor(props) {\n      super(props);\n      console.log('HOC', 'constructor', props);\n      ReactResponsiveNextHoc.mediaQueriesMatchers = [];\n      const { config } = this.props;\n      const media = getMedia(config);\n\n      Object.keys(media).forEach((type) => {\n        const { mediaQuery, defaultWidth } = media[type];\n        const matcher = matchMediaQuery(mediaQuery, {\n          width: ReactResponsiveNextHoc.getBrowserWidth(),\n        });\n        ReactResponsiveNextHoc.mediaQueriesMatchers.push({\n          type,\n          matcher,\n          defaultWidth,\n        })\n      });\n      this.state = {\n        env: {},\n      };\n    }\n\n    componentDidMount() {\n      console.log('HOC', 'componentDidMount');\n      ReactResponsiveNextHoc.onResize();\n      this.onResizeHandler = debounce(ReactResponsiveNextHoc.onResize, 200);\n      window.addEventListener('resize', this.onResizeHandler, false);\n    }\n\n    componentWillUnmount() {\n      console.log('HOC', 'componentWillUnmount');\n      if (this.onResizeHandler) {\n        window.removeEventListener('resize', this.onResizeHandler, false);\n      }\n    }\n\n    render() {\n      console.log('HOC', 'render');\n      return <WrappedComponent {...this.state} {...this.props} />;\n    }\n  };\n"],"file":"hoc.js"}