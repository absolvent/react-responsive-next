{"version":3,"sources":["../src/react-responsive-connect.js"],"names":["debounce","matchMediaQuery","PropTypes","Cookies","React","MediaQueryWrapper","getMedia","defaultConfig","ReactResponsiveConnect","WrappedComponent","detectedMedia","ReactResponsiveNextHoc","mediaQueriesMatchers","forEach","mediaItem","matcher","matches","defaultWidth","previouslyDetectedMediaWidth","load","save","secure","type","initialWidth","window","location","reload","updateDeviceTypeByViewportSize","detectedMediaWidth","args","newProps","env","req","device","eval","detectedMediaType","checkEnvironment","headers","ua","detectedDevice","userAgentMediaType","getDefaultMediaWidthByType","detectedMediaModel","model","res","cookie","maxAge","httpOnly","newArgs","getInitialProps","process","browser","fakeWidth","contextService","require","set","mediaType","media","customConfig","desktop","innerWidth","document","documentElement","clientWidth","body","props","config","Object","keys","mediaQuery","width","getBrowserWidth","push","state","onResizeHandler","onResize","addEventListener","onBeforeUnload","reloadPageIfIncorrectWidthDetected","removeEventListener","Component","propTypes","shape","breakPoints","any","devicesToBreakPoints","defaultProps"],"mappings":"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","sourcesContent":["/* global require */\n\nimport debounce from 'lodash.debounce';\nimport matchMediaQuery from 'matchmediaquery';\nimport PropTypes from 'prop-types';\nimport Cookies from 'isomorphic-cookie';\nimport React from 'react';\nimport { MediaQueryWrapper } from './components';\nimport { getMedia } from './media';\nimport { defaultConfig } from './default-config';\n\nexport const ReactResponsiveConnect = WrappedComponent =>\n  class ReactResponsiveNextHoc extends React.Component {\n\n    static customConfig = null;\n\n    static updateDeviceTypeByViewportSize() {\n      let detectedMedia = null;\n      ReactResponsiveNextHoc.mediaQueriesMatchers.forEach((mediaItem) => {\n        if (mediaItem.matcher.matches) {\n          if (!detectedMedia\n            || (detectedMedia && detectedMedia.defaultWidth < mediaItem.defaultWidth)) {\n            detectedMedia = mediaItem;\n          }\n        }\n      });\n      const previouslyDetectedMediaWidth = Cookies.load('detectedMediaWidth') || null;\n\n      Cookies.save('detectedMediaWidth', detectedMedia.defaultWidth, { secure: false });\n      Cookies.save('detectedMediaType', detectedMedia.type, { secure: false });\n\n      if (!previouslyDetectedMediaWidth) {\n        const initialWidth = Cookies.load('initialMediaWidth') || null;\n        if (initialWidth !== detectedMedia.defaultWidth) {\n          window.location.reload();\n        }\n      }\n    }\n\n    static propTypes = {\n      config: PropTypes.shape({\n        breakPoints: PropTypes.any,\n        devicesToBreakPoints: PropTypes.any,\n      }),\n    };\n\n    static defaultProps = {\n      config: ReactResponsiveConnect.customConfig || defaultConfig,\n    };\n\n    static onResize() {\n      ReactResponsiveNextHoc.updateDeviceTypeByViewportSize();\n    }\n\n    static onBeforeUnload() {\n      ReactResponsiveNextHoc.updateDeviceTypeByViewportSize();\n    }\n\n    static reloadPageIfIncorrectWidthDetected() {\n      const previouslyDetectedMediaWidth = Cookies.load('detectedMediaWidth') || null;\n      ReactResponsiveNextHoc.updateDeviceTypeByViewportSize();\n      const detectedMediaWidth = Cookies.load('detectedMediaWidth');\n      if (previouslyDetectedMediaWidth && (detectedMediaWidth !== previouslyDetectedMediaWidth)) {\n        window.location.reload();\n      }\n    }\n\n    static async getInitialProps(args = {}) {\n      let newProps = {\n        env: {},\n      };\n\n      if (args && args.req) {\n        const device = eval('require(\\'device\\')'); // it's not bundled to a browser js\n        const detectedMediaType = Cookies.load('detectedMediaType', args.req);\n        const detectedMediaWidth = Cookies.load('detectedMediaWidth', args.req);\n        const checkEnvironment = ({ headers = {} } = {}) => {\n          const ua = headers['user-agent'] || headers['User-Agent'] || '';\n          const detectedDevice = device(ua);\n          return {\n            userAgentMediaType: detectedDevice.type,\n            detectedMediaType: detectedMediaType || detectedDevice.type,\n            detectedMediaWidth: detectedMediaWidth\n              || ReactResponsiveNextHoc.getDefaultMediaWidthByType(detectedDevice.type),\n            detectedMediaModel: detectedDevice.model || null,\n          }\n        };\n        newProps.env = checkEnvironment(args.req);\n        args.res.cookie('initialMediaWidth', newProps.env.detectedMediaWidth, { maxAge: 60000, httpOnly: false });\n      } else {\n        newProps.env = {\n          userAgentMediaType: null,\n          detectedMediaType: null,\n          detectedMediaWidth: 0,\n          detectedMediaModel: null,\n        };\n      }\n      const newArgs = {\n        ...args,\n        ...newProps,\n      };\n      if (WrappedComponent.getInitialProps) {\n        newProps = {\n          ...newProps,\n          ...await WrappedComponent.getInitialProps(newArgs),\n        };\n      }\n      if (process.browser) {\n        MediaQueryWrapper.fakeWidth = newProps.env.detectedMediaWidth;\n      } else {\n        const contextService = require('request-context');\n        contextService.set('request:responsive', newProps.env);\n      }\n\n      return newProps;\n    }\n\n    static getDefaultMediaWidthByType(mediaType) {\n      const media = getMedia(ReactResponsiveConnect.customConfig || defaultConfig);\n      if (media[mediaType]) {\n        return media[mediaType].defaultWidth;\n      }\n      return media.desktop.defaultWidth;\n    }\n\n    static getBrowserWidth() {\n      if (process.browser) {\n        return window.innerWidth ||\n          document.documentElement.clientWidth ||\n          document.body.clientWidth;\n      }\n      return -1;\n    }\n\n    constructor(props) {\n      super(props);\n\n      ReactResponsiveNextHoc.mediaQueriesMatchers = [];\n      const { config } = this.props;\n      const media = getMedia(config);\n\n      Object.keys(media).forEach((type) => {\n        const { mediaQuery, defaultWidth } = media[type];\n        const matcher = matchMediaQuery(mediaQuery, {\n          width: ReactResponsiveNextHoc.getBrowserWidth(),\n        });\n        ReactResponsiveNextHoc.mediaQueriesMatchers.push({\n          type,\n          matcher,\n          defaultWidth,\n        })\n      });\n\n      this.state = {\n        env: {},\n      };\n    }\n\n    componentDidMount() {\n      this.onResizeHandler = debounce(ReactResponsiveNextHoc.onResize, 200);\n      window.addEventListener('resize', this.onResizeHandler, false);\n      window.addEventListener('beforeunload', ReactResponsiveNextHoc.onBeforeUnload, false);\n\n      ReactResponsiveNextHoc.reloadPageIfIncorrectWidthDetected()\n    }\n\n    componentWillUnmount() {\n      if (this.onResizeHandler) {\n        window.removeEventListener('resize', this.onResizeHandler, false);\n      }\n    }\n\n    render() {\n      return <WrappedComponent {...this.state} {...this.props} />;\n    }\n  };\n"],"file":"react-responsive-connect.js"}